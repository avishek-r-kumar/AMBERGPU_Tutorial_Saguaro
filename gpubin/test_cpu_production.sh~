#!/bin/bash
#!/bin/bash
#PBS -l nodes=1:ppn=1
#PBS -l walltime=220:00:00
#PBS -l mem=1GB
#PBS -j oe
#PBS -q shortq

cd $PBS_O_WORKDIR


usage="""
Minimize Solution
=================

Description
-----------
Shell script for minimizing solution in AMBER GPU explict water simulation

Usage
-----
./minimize_solution PARMFIL CRDFIL 
"""

module load shared gcc torque slurm cuda/7.0 amber/14 python-2.7.10/2.7.10
PATH=${PATH}:/home/akumar67/BetalactamaseGPURuns/scripts

PARM=$(ls *_TIP3P.prmtop)
CRD=$(ls *_TIP3P-heatup.rst)
title=$(echo $PARM | cut -d. -f1)


if [ -z "${PARM}"]; 
then
    echo "NO PRMTOP FILE"
    echo "$usage" 
    exit 
fi

if [ -z "${CRD}" ];
then
    echo "NO CRD FILE"
    echo "$usgae"
    exit 
fi 

echo $PARM
echo $CRD
echo $title 

cp -v ~/BetalactamaseGPURuns/scripts/test_cpu_production.in . 

${AMBERHOME}/bin/pmemd -O \
-i test_cpu_production.in \
-o test_cpu_production.out \
-p ${PARM} \
-c ${CRD} \
-r ${title}-testcpuprod.rst \
-x ${title}-testcpuprod.mdcrd \
-ref ${CRD} 

#${AMBERHOME}/bin/amberpdb -p ${PARM} < ${CRD} > ${title}-min2.pdb 
